import{createRequire as W3}from"node:module";var U3=Object.create;var{getPrototypeOf:H3,defineProperty:d,getOwnPropertyNames:l0,getOwnPropertyDescriptor:K3}=Object,o0=Object.prototype.hasOwnProperty;var Q3=(G,O,X)=>{X=G!=null?U3(H3(G)):{};const J=O||!G||!G.__esModule?d(X,"default",{value:G,enumerable:!0}):X;for(let Z of l0(G))if(!o0.call(J,Z))d(J,Z,{get:()=>G[Z],enumerable:!0});return J},c0=new WeakMap,R3=(G)=>{var O=c0.get(G),X;if(O)return O;if(O=d({},"__esModule",{value:!0}),G&&typeof G==="object"||typeof G==="function")l0(G).map((J)=>!o0.call(O,J)&&d(O,J,{get:()=>G[J],enumerable:!(X=K3(G,J))||X.enumerable}));return c0.set(G,O),O};var R=(G,O)=>()=>(O||G((O={exports:{}}).exports,O),O.exports);var E3=(G,O)=>{for(var X in O)d(G,X,{get:O[X],enumerable:!0,configurable:!0,set:(J)=>O[X]=()=>J})};var j3=(G,O)=>()=>(G&&(O=G(G=0)),O);var W=W3(import.meta.url);var K0=R((F3)=>{function T3(G){return G}F3.parse=function(G,O){return new H0(G,O).parse()};class H0{constructor(G,O){this.source=G,this.transform=O||T3,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var G=this.source[this.position++];if(G==="\\")return{value:this.source[this.position++],escaped:!0};return{value:G,escaped:!1}}record(G){this.recorded.push(G)}newEntry(G){var O;if(this.recorded.length>0||G){if(O=this.recorded.join(""),O==="NULL"&&!G)O=null;if(O!==null)O=this.transform(O);this.entries.push(O),this.recorded=[]}}consumeDimensions(){if(this.source[0]==="[")while(!this.isEof()){var G=this.nextCharacter();if(G.value==="=")break}}parse(G){var O,X,J;this.consumeDimensions();while(!this.isEof())if(O=this.nextCharacter(),O.value==="{"&&!J){if(this.dimension++,this.dimension>1)X=new H0(this.source.substr(this.position-1),this.transform),this.entries.push(X.parse(!0)),this.position+=X.position-2}else if(O.value==="}"&&!J){if(this.dimension--,!this.dimension){if(this.newEntry(),G)return this.entries}}else if(O.value==='"'&&!O.escaped){if(J)this.newEntry(!0);J=!J}else if(O.value===","&&!J)this.newEntry();else this.record(O.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}}});var Q0=R(($4,n0)=>{var N3=K0();n0.exports={create:function(G,O){return{parse:function(){return N3.parse(G,O)}}}}});var s0=R((Y4,a0)=>{function _3(G){var O=M3.exec(G);if(!O)return;var X=parseInt(O[1],10),J=!!O[4];if(J)X=i0(X);var Z=parseInt(O[2],10)-1,$=O[3],Y=new Date(X,Z,$);if(R0(X))Y.setFullYear(X);return Y}function S3(G){if(G.endsWith("+00"))return 0;var O=L3.exec(G.split(" ")[1]);if(!O)return;var X=O[1];if(X==="Z")return 0;var J=X==="-"?-1:1,Z=parseInt(O[2],10)*3600+parseInt(O[3]||0,10)*60+parseInt(O[4]||0,10);return Z*J*1000}function i0(G){return-(G-1)}function R0(G){return G>=0&&G<100}var z3=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,M3=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,L3=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,V3=/^-?infinity$/;a0.exports=function G(O){if(V3.test(O))return Number(O.replace("i","I"));var X=z3.exec(O);if(!X)return _3(O)||null;var J=!!X[8],Z=parseInt(X[1],10);if(J)Z=i0(Z);var $=parseInt(X[2],10)-1,Y=X[3],U=parseInt(X[4],10),H=parseInt(X[5],10),K=parseInt(X[6],10),Q=X[7];Q=Q?1000*parseFloat(Q):0;var E,j=S3(O);if(j!=null){if(E=new Date(Date.UTC(Z,$,Y,U,H,K,Q)),R0(Z))E.setUTCFullYear(Z);if(j!==0)E.setTime(E.getTime()-j)}else if(E=new Date(Z,$,Y,U,H,K,Q),R0(Z))E.setFullYear(Z);return E}});var r0=R((U4,t0)=>{function P3(G){for(var O=1;O<arguments.length;O++){var X=arguments[O];for(var J in X)if(I3.call(X,J))G[J]=X[J]}return G}t0.exports=P3;var I3=Object.prototype.hasOwnProperty});var O1=R((H4,G1)=>{function x(G){if(!(this instanceof x))return new x(G);C3(this,m3(G))}function d3(G){var O=G+"000000".slice(G.length);return parseInt(O,10)/1000}function m3(G){if(!G)return{};var O=y3.exec(G),X=O[8]==="-";return Object.keys(e0).reduce(function(J,Z){var $=e0[Z],Y=O[$];if(!Y)return J;if(Y=Z==="milliseconds"?d3(Y):parseInt(Y,10),!Y)return J;if(X&&~v3.indexOf(Z))Y*=-1;return J[Z]=Y,J},{})}var C3=r0();G1.exports=x;var q3=["seconds","minutes","hours","days","months","years"];x.prototype.toPostgres=function(){var G=q3.filter(this.hasOwnProperty,this);if(this.milliseconds&&G.indexOf("seconds")<0)G.push("seconds");if(G.length===0)return"0";return G.map(function(O){var X=this[O]||0;if(O==="seconds"&&this.milliseconds)X=(X+this.milliseconds/1000).toFixed(6).replace(/\.?0+$/,"");return X+" "+O},this).join(" ")};var D3={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},B3=["years","months","days"],x3=["hours","minutes","seconds"];x.prototype.toISOString=x.prototype.toISO=function(){var G=B3.map(X,this).join(""),O=x3.map(X,this).join("");return"P"+G+"T"+O;function X(J){var Z=this[J]||0;if(J==="seconds"&&this.milliseconds)Z=(Z+this.milliseconds/1000).toFixed(6).replace(/0+$/,"");return Z+D3[J]}};var E0="([+-]?\\d+)",k3=E0+"\\s+years?",w3=E0+"\\s+mons?",h3=E0+"\\s+days?",b3="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",y3=new RegExp([k3,w3,h3,b3].map(function(G){return"("+G+")?"}).join("\\s*")),e0={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},v3=["hours","minutes","seconds","milliseconds"]});var J1=R((K4,X1)=>{X1.exports=function G(O){if(/^\\x/.test(O))return new Buffer(O.substr(2),"hex");var X="",J=0;while(J<O.length)if(O[J]!=="\\")X+=O[J],++J;else if(/[0-7]{3}/.test(O.substr(J+1,3)))X+=String.fromCharCode(parseInt(O.substr(J+1,3),8)),J+=4;else{var Z=1;while(J+Z<O.length&&O[J+Z]==="\\")Z++;for(var $=0;$<Math.floor(Z/2);++$)X+="\\";J+=Math.floor(Z/2)*2}return new Buffer(X,"binary")}});var Q1=R((Q4,K1)=>{function t(G){return function O(X){if(X===null)return X;return G(X)}}function U1(G){if(G===null)return G;return G==="TRUE"||G==="t"||G==="true"||G==="y"||G==="yes"||G==="on"||G==="1"}function p3(G){if(!G)return null;return m.parse(G,U1)}function u3(G){return parseInt(G,10)}function j0(G){if(!G)return null;return m.parse(G,t(u3))}function f3(G){if(!G)return null;return m.parse(G,t(function(O){return H1(O).trim()}))}var m=K0(),p=Q0(),s=s0(),$1=O1(),Y1=J1(),g3=function(G){if(!G)return null;var O=p.create(G,function(X){if(X!==null)X=A0(X);return X});return O.parse()},W0=function(G){if(!G)return null;var O=p.create(G,function(X){if(X!==null)X=parseFloat(X);return X});return O.parse()},S=function(G){if(!G)return null;var O=p.create(G);return O.parse()},T0=function(G){if(!G)return null;var O=p.create(G,function(X){if(X!==null)X=s(X);return X});return O.parse()},c3=function(G){if(!G)return null;var O=p.create(G,function(X){if(X!==null)X=$1(X);return X});return O.parse()},l3=function(G){if(!G)return null;return m.parse(G,t(Y1))},F0=function(G){return parseInt(G,10)},H1=function(G){var O=String(G);if(/^\d+$/.test(O))return O;return G},Z1=function(G){if(!G)return null;return m.parse(G,t(JSON.parse))},A0=function(G){if(G[0]!=="(")return null;return G=G.substring(1,G.length-1).split(","),{x:parseFloat(G[0]),y:parseFloat(G[1])}},o3=function(G){if(G[0]!=="<"&&G[1]!=="(")return null;var O="(",X="",J=!1;for(var Z=2;Z<G.length-1;Z++){if(!J)O+=G[Z];if(G[Z]===")"){J=!0;continue}else if(!J)continue;if(G[Z]===",")continue;X+=G[Z]}var $=A0(O);return $.radius=parseFloat(X),$},n3=function(G){G(20,H1),G(21,F0),G(23,F0),G(26,F0),G(700,parseFloat),G(701,parseFloat),G(16,U1),G(1082,s),G(1114,s),G(1184,s),G(600,A0),G(651,S),G(718,o3),G(1000,p3),G(1001,l3),G(1005,j0),G(1007,j0),G(1028,j0),G(1016,f3),G(1017,g3),G(1021,W0),G(1022,W0),G(1231,W0),G(1014,S),G(1015,S),G(1008,S),G(1009,S),G(1040,S),G(1041,S),G(1115,T0),G(1182,T0),G(1185,T0),G(1186,$1),G(1187,c3),G(17,Y1),G(114,JSON.parse.bind(JSON)),G(3802,JSON.parse.bind(JSON)),G(199,Z1),G(3807,Z1),G(3907,S),G(2951,S),G(791,S),G(1183,S),G(1270,S)};K1.exports={init:n3}});var E1=R((R4,R1)=>{function i3(G){var O=G.readInt32BE(0),X=G.readUInt32BE(4),J="";if(O<0)O=~O+(X===0),X=~X+1>>>0,J="-";var Z="",$,Y,U,H,K,Q;{if($=O%V,O=O/V>>>0,Y=4294967296*$+X,X=Y/V>>>0,U=""+(Y-V*X),X===0&&O===0)return J+U+Z;H="",K=6-U.length;for(Q=0;Q<K;Q++)H+="0";Z=H+U+Z}{if($=O%V,O=O/V>>>0,Y=4294967296*$+X,X=Y/V>>>0,U=""+(Y-V*X),X===0&&O===0)return J+U+Z;H="",K=6-U.length;for(Q=0;Q<K;Q++)H+="0";Z=H+U+Z}{if($=O%V,O=O/V>>>0,Y=4294967296*$+X,X=Y/V>>>0,U=""+(Y-V*X),X===0&&O===0)return J+U+Z;H="",K=6-U.length;for(Q=0;Q<K;Q++)H+="0";Z=H+U+Z}return $=O%V,Y=4294967296*$+X,U=""+Y%V,J+U+Z}var V=1e6;R1.exports=i3});var A1=R((E4,F1)=>{var a3=E1(),T=function(G,O,X,J,Z){X=X||0,J=J||!1,Z=Z||function(z,Y0,U0){return z*Math.pow(2,U0)+Y0};var $=X>>3,Y=function(z){if(J)return~z&255;return z},U=255,H=8-X%8;if(O<H)U=255<<8-O&255,H=O;if(X)U=U>>X%8;var K=0;if(X%8+O>=8)K=Z(0,Y(G[$])&U,H);var Q=O+X>>3;for(var E=$+1;E<Q;E++)K=Z(K,Y(G[E]),8);var j=(O+X)%8;if(j>0)K=Z(K,Y(G[Q])>>8-j,j);return K},T1=function(G,O,X){var J=Math.pow(2,X-1)-1,Z=T(G,1),$=T(G,X,1);if($===0)return 0;var Y=1,U=function(K,Q,E){if(K===0)K=1;for(var j=1;j<=E;j++)if(Y/=2,(Q&1<<E-j)>0)K+=Y;return K},H=T(G,O,X+1,!1,U);if($==Math.pow(2,X+1)-1){if(H===0)return Z===0?1/0:-1/0;return NaN}return(Z===0?1:-1)*Math.pow(2,$-J)*H},s3=function(G){if(T(G,1)==1)return-1*(T(G,15,1,!0)+1);return T(G,15,1)},j1=function(G){if(T(G,1)==1)return-1*(T(G,31,1,!0)+1);return T(G,31,1)},t3=function(G){return T1(G,23,8)},r3=function(G){return T1(G,52,11)},e3=function(G){var O=T(G,16,32);if(O==49152)return NaN;var X=Math.pow(1e4,T(G,16,16)),J=0,Z=[],$=T(G,16);for(var Y=0;Y<$;Y++)J+=T(G,16,64+16*Y)*X,X/=1e4;var U=Math.pow(10,T(G,16,48));return(O===0?1:-1)*Math.round(J*U)/U},W1=function(G,O){var X=T(O,1),J=T(O,63,1),Z=new Date((X===0?1:-1)*J/1000+946684800000);if(!G)Z.setTime(Z.getTime()+Z.getTimezoneOffset()*60000);return Z.usec=J%1000,Z.getMicroSeconds=function(){return this.usec},Z.setMicroSeconds=function($){this.usec=$},Z.getUTCMicroSeconds=function(){return this.usec},Z},u=function(G){var O=T(G,32),X=T(G,32,32),J=T(G,32,64),Z=96,$=[];for(var Y=0;Y<O;Y++)$[Y]=T(G,32,Z),Z+=32,Z+=32;var U=function(K){var Q=T(G,32,Z);if(Z+=32,Q==4294967295)return null;var E;if(K==23||K==20)return E=T(G,Q*8,Z),Z+=Q*8,E;else if(K==25)return E=G.toString(this.encoding,Z>>3,(Z+=Q<<3)>>3),E;else console.log("ERROR: ElementType not implemented: "+K)},H=function(K,Q){var E=[],j;if(K.length>1){var z=K.shift();for(j=0;j<z;j++)E[j]=H(K,Q);K.unshift(z)}else for(j=0;j<K[0];j++)E[j]=U(Q);return E};return H($,J)},G7=function(G){return G.toString("utf8")},O7=function(G){if(G===null)return null;return T(G,8)>0},X7=function(G){G(20,a3),G(21,s3),G(23,j1),G(26,j1),G(1700,e3),G(700,t3),G(701,r3),G(16,O7),G(1114,W1.bind(null,!1)),G(1184,W1.bind(null,!0)),G(1000,u),G(1007,u),G(1016,u),G(1008,u),G(1009,u),G(25,G7)};F1.exports={init:X7}});var z1=R((j4,N1)=>{N1.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var g=R((K7)=>{function M1(G){return String(G)}function U7(G,O){if(O=O||"text",!f[O])return M1;return f[O][G]||M1}function H7(G,O,X){if(typeof O=="function")X=O,O="text";f[O][G]=X}var J7=Q1(),Z7=A1(),$7=Q0(),Y7=z1();K7.getTypeParser=U7;K7.setTypeParser=H7;K7.arrayParser=$7;K7.builtins=Y7;var f={text:{},binary:{}};J7.init(function(G,O){f.text[G]=O});Z7.init(function(G,O){f.binary[G]=O})});var c=R((T4,N0)=>{N0.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:30000,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var k=g(),W7=k.getTypeParser(20,"text"),T7=k.getTypeParser(1016,"text");N0.exports.__defineSetter__("parseInt8",function(G){k.setTypeParser(20,"text",G?k.getTypeParser(23,"text"):W7),k.setTypeParser(1016,"text",G?k.getTypeParser(1007,"text"):T7)})});var l=R((F4,V1)=>{function A7(G){var O=G.replace(/\\/g,"\\\\").replace(/"/g,'\\"');return'"'+O+'"'}function L1(G){var O="{";for(var X=0;X<G.length;X++){if(X>0)O=O+",";if(G[X]===null||typeof G[X]==="undefined")O=O+"NULL";else if(Array.isArray(G[X]))O=O+L1(G[X]);else if(ArrayBuffer.isView(G[X])){var J=G[X];if(!(J instanceof Buffer)){var Z=Buffer.from(J.buffer,J.byteOffset,J.byteLength);if(Z.length===J.byteLength)J=Z;else J=Z.slice(J.byteOffset,J.byteOffset+J.byteLength)}O+="\\\\x"+J.toString("hex")}else O+=A7(r(G[X]))}return O=O+"}",O}function N7(G,O){if(G&&typeof G.toPostgres==="function"){if(O=O||[],O.indexOf(G)!==-1)throw new Error('circular reference detected while preparing "'+G+'" for query');return O.push(G),r(G.toPostgres(r),O)}return JSON.stringify(G)}function M(G,O){G=""+G;while(G.length<O)G="0"+G;return G}function z7(G){var O=-G.getTimezoneOffset(),X=G.getFullYear(),J=X<1;if(J)X=Math.abs(X)+1;var Z=M(X,4)+"-"+M(G.getMonth()+1,2)+"-"+M(G.getDate(),2)+"T"+M(G.getHours(),2)+":"+M(G.getMinutes(),2)+":"+M(G.getSeconds(),2)+"."+M(G.getMilliseconds(),3);if(O<0)Z+="-",O*=-1;else Z+="+";if(Z+=M(Math.floor(O/60),2)+":"+M(O%60,2),J)Z+=" BC";return Z}function M7(G){var O=G.getUTCFullYear(),X=O<1;if(X)O=Math.abs(O)+1;var J=M(O,4)+"-"+M(G.getUTCMonth()+1,2)+"-"+M(G.getUTCDate(),2)+"T"+M(G.getUTCHours(),2)+":"+M(G.getUTCMinutes(),2)+":"+M(G.getUTCSeconds(),2)+"."+M(G.getUTCMilliseconds(),3);if(J+="+00:00",X)J+=" BC";return J}function L7(G,O,X){if(G=typeof G==="string"?{text:G}:G,O)if(typeof O==="function")G.callback=O;else G.values=O;if(X)G.callback=X;return G}var F7=c(),r=function(G,O){if(G==null)return null;if(G instanceof Buffer)return G;if(ArrayBuffer.isView(G)){var X=Buffer.from(G.buffer,G.byteOffset,G.byteLength);if(X.length===G.byteLength)return X;return X.slice(G.byteOffset,G.byteOffset+G.byteLength)}if(G instanceof Date)if(F7.parseInputDatesAsUTC)return M7(G);else return z7(G);if(Array.isArray(G))return L1(G);if(typeof G==="object")return N7(G,O);return G.toString()},V7=function(G){return'"'+G.replace(/"/g,'""')+'"'},_7=function(G){var O=!1,X="'";for(var J=0;J<G.length;J++){var Z=G[J];if(Z==="'")X+=Z+Z;else if(Z==="\\")X+=Z+Z,O=!0;else X+=Z}if(X+="'",O===!0)X=" E"+X;return X};V1.exports={prepareValue:function G(O){return r(O)},normalizeQueryConfig:L7,escapeIdentifier:V7,escapeLiteral:_7}});var S1=R((A4,_1)=>{function z0(G){return o.createHash("md5").update(G,"utf-8").digest("hex")}function S7(G,O,X){var J=z0(O+G),Z=z0(Buffer.concat([Buffer.from(J),X]));return"md5"+Z}function I7(G){return o.createHash("sha256").update(G).digest()}function P7(G,O){return o.createHmac("sha256",G).update(O).digest()}async function C7(G,O,X){return o.pbkdf2Sync(G,O,X,32,"sha256")}var o=W("crypto");_1.exports={postgresMd5PasswordHash:S7,randomBytes:o.randomBytes,deriveKey:C7,sha256:I7,hmacSha256:P7,md5:z0}});var q1=R((N4,C1)=>{function q7(G){return P1.getRandomValues(Buffer.alloc(G))}async function M0(G){try{return I1.createHash("md5").update(G,"utf-8").digest("hex")}catch(O){const X=typeof G==="string"?L0.encode(G):G,J=await w.digest("MD5",X);return Array.from(new Uint8Array(J)).map((Z)=>Z.toString(16).padStart(2,"0")).join("")}}async function D7(G,O,X){var J=await M0(O+G),Z=await M0(Buffer.concat([Buffer.from(J),X]));return"md5"+Z}async function B7(G){return await w.digest("SHA-256",G)}async function x7(G,O){const X=await w.importKey("raw",G,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await w.sign("HMAC",X,L0.encode(O))}async function k7(G,O,X){const J=await w.importKey("raw",L0.encode(G),"PBKDF2",!1,["deriveBits"]),Z={name:"PBKDF2",hash:"SHA-256",salt:O,iterations:X};return await w.deriveBits(Z,J,256,["deriveBits"])}var I1=W("crypto");C1.exports={postgresMd5PasswordHash:D7,randomBytes:q7,deriveKey:k7,sha256:B7,hmacSha256:x7,md5:M0};var P1=I1.webcrypto||globalThis.crypto,w=P1.subtle,L0=new TextEncoder});var _0=R((z4,V0)=>{var w7=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;if(w7)V0.exports=S1();else V0.exports=q1()});var k1=R((M4,x1)=>{function h7(G){if(G.indexOf("SCRAM-SHA-256")===-1)throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");const O=D.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:O,response:"n,,n=*,r="+O,message:"SASLInitialResponse"}}async function b7(G,O,X){if(G.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof O!=="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(O==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof X!=="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");const J=d7(X);if(!J.nonce.startsWith(G.clientNonce))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");else if(J.nonce.length===G.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");var Z="n=*,r="+G.clientNonce,$="r="+J.nonce+",s="+J.salt+",i="+J.iteration,Y="c=biws,r="+J.nonce,U=Z+","+$+","+Y,H=Buffer.from(J.salt,"base64"),K=await D.deriveKey(O,H,J.iteration),Q=await D.hmacSha256(K,"Client Key"),E=await D.sha256(Q),j=await D.hmacSha256(E,U),z=p7(Buffer.from(Q),Buffer.from(j)).toString("base64"),Y0=await D.hmacSha256(K,"Server Key"),U0=await D.hmacSha256(Y0,U);G.message="SASLResponse",G.serverSignature=Buffer.from(U0).toString("base64"),G.response=Y+",p="+z}function y7(G,O){if(G.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof O!=="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");const{serverSignature:X}=m7(O);if(X!==G.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function v7(G){if(typeof G!=="string")throw new TypeError("SASL: text must be a string");return G.split("").map((O,X)=>G.charCodeAt(X)).every((O)=>O>=33&&O<=43||O>=45&&O<=126)}function D1(G){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(G)}function B1(G){if(typeof G!=="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(G.split(",").map((O)=>{if(!/^.=/.test(O))throw new Error("SASL: Invalid attribute pair entry");const X=O[0],J=O.substring(2);return[X,J]}))}function d7(G){const O=B1(G),X=O.get("r");if(!X)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");else if(!v7(X))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters");const J=O.get("s");if(!J)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");else if(!D1(J))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64");const Z=O.get("i");if(!Z)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");else if(!/^[1-9][0-9]*$/.test(Z))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count");const $=parseInt(Z,10);return{nonce:X,salt:J,iteration:$}}function m7(G){const X=B1(G).get("v");if(!X)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");else if(!D1(X))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64");return{serverSignature:X}}function p7(G,O){if(!Buffer.isBuffer(G))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(O))throw new TypeError("second argument must be a Buffer");if(G.length!==O.length)throw new Error("Buffer lengths must match");if(G.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(G.map((X,J)=>G[J]^O[J]))}var D=_0();x1.exports={startSession:h7,continueSession:b7,finalizeSession:y7}});var S0=R((L4,w1)=>{function e(G){this._types=G||u7,this.text={},this.binary={}}var u7=g();e.prototype.getOverrides=function(G){switch(G){case"text":return this.text;case"binary":return this.binary;default:return{}}};e.prototype.setTypeParser=function(G,O,X){if(typeof O==="function")X=O,O="text";this.getOverrides(O)[G]=X};e.prototype.getTypeParser=function(G,O){return O=O||"text",this.getOverrides(O)[G]||this._types.getTypeParser(G,O)};w1.exports=e});var b1=R((V4,h1)=>{function I0(G){if(G.charAt(0)==="/"){const U=G.split(" ");return{host:U[0],database:U[1]}}const O={};let X,J=!1;if(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(G))G=encodeURI(G).replace(/\%25(\d\d)/g,"%$1");try{X=new URL(G,"postgres://base")}catch(U){X=new URL(G.replace("@/","@___DUMMY___/"),"postgres://base"),J=!0}for(let U of X.searchParams.entries())O[U[0]]=U[1];if(O.user=O.user||decodeURIComponent(X.username),O.password=O.password||decodeURIComponent(X.password),X.protocol=="socket:")return O.host=decodeURI(X.pathname),O.database=X.searchParams.get("db"),O.client_encoding=X.searchParams.get("encoding"),O;const Z=J?"":X.hostname;if(!O.host)O.host=decodeURIComponent(Z);else if(Z&&/^%2f/i.test(Z))X.pathname=Z+X.pathname;if(!O.port)O.port=X.port;const $=X.pathname.slice(1)||null;if(O.database=$?decodeURI($):null,O.ssl==="true"||O.ssl==="1")O.ssl=!0;if(O.ssl==="0")O.ssl=!1;if(O.sslcert||O.sslkey||O.sslrootcert||O.sslmode)O.ssl={};const Y=O.sslcert||O.sslkey||O.sslrootcert?W("fs"):null;if(O.sslcert)O.ssl.cert=Y.readFileSync(O.sslcert).toString();if(O.sslkey)O.ssl.key=Y.readFileSync(O.sslkey).toString();if(O.sslrootcert)O.ssl.ca=Y.readFileSync(O.sslrootcert).toString();switch(O.sslmode){case"disable":{O.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{O.ssl.rejectUnauthorized=!1;break}}return O}h1.exports=I0;I0.parse=I0});var P0=R((_4,m1)=>{var f7=W("dns"),v1=c(),y1=b1().parse,L=function(G,O,X){if(X===void 0)X=process.env["PG"+G.toUpperCase()];else if(X===!1);else X=process.env[X];return O[G]||X||v1[G]},g7=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return v1.ssl},h=function(G){return"'"+(""+G).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},I=function(G,O,X){var J=O[X];if(J!==void 0&&J!==null)G.push(X+"="+h(J))};class d1{constructor(G){if(G=typeof G==="string"?y1(G):G||{},G.connectionString)G=Object.assign({},G,y1(G.connectionString));if(this.user=L("user",G),this.database=L("database",G),this.database===void 0)this.database=this.user;if(this.port=parseInt(L("port",G),10),this.host=L("host",G),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:L("password",G)}),this.binary=L("binary",G),this.options=L("options",G),this.ssl=typeof G.ssl==="undefined"?g7():G.ssl,typeof this.ssl==="string"){if(this.ssl==="true")this.ssl=!0}if(this.ssl==="no-verify")this.ssl={rejectUnauthorized:!1};if(this.ssl&&this.ssl.key)Object.defineProperty(this.ssl,"key",{enumerable:!1});if(this.client_encoding=L("client_encoding",G),this.replication=L("replication",G),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=L("application_name",G,"PGAPPNAME"),this.fallback_application_name=L("fallback_application_name",G,!1),this.statement_timeout=L("statement_timeout",G,!1),this.lock_timeout=L("lock_timeout",G,!1),this.idle_in_transaction_session_timeout=L("idle_in_transaction_session_timeout",G,!1),this.query_timeout=L("query_timeout",G,!1),G.connectionTimeoutMillis===void 0)this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0;else this.connect_timeout=Math.floor(G.connectionTimeoutMillis/1000);if(G.keepAlive===!1)this.keepalives=0;else if(G.keepAlive===!0)this.keepalives=1;if(typeof G.keepAliveInitialDelayMillis==="number")this.keepalives_idle=Math.floor(G.keepAliveInitialDelayMillis/1000)}getLibpqConnectionString(G){var O=[];I(O,this,"user"),I(O,this,"password"),I(O,this,"port"),I(O,this,"application_name"),I(O,this,"fallback_application_name"),I(O,this,"connect_timeout"),I(O,this,"options");var X=typeof this.ssl==="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(I(O,X,"sslmode"),I(O,X,"sslca"),I(O,X,"sslkey"),I(O,X,"sslcert"),I(O,X,"sslrootcert"),this.database)O.push("dbname="+h(this.database));if(this.replication)O.push("replication="+h(this.replication));if(this.host)O.push("host="+h(this.host));if(this.isDomainSocket)return G(null,O.join(" "));if(this.client_encoding)O.push("client_encoding="+h(this.client_encoding));f7.lookup(this.host,function(J,Z){if(J)return G(J,null);return O.push("hostaddr="+h(Z)),G(null,O.join(" "))})}}m1.exports=d1});var g1=R((S4,f1)=>{var c7=g(),p1=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/;class u1{constructor(G,O){if(this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=O,this.RowCtor=null,this.rowAsArray=G==="array",this.rowAsArray)this.parseRow=this._parseRowAsArray;this._prebuiltEmptyResultObject=null}addCommandComplete(G){var O;if(G.text)O=p1.exec(G.text);else O=p1.exec(G.command);if(O){if(this.command=O[1],O[3])this.oid=parseInt(O[2],10),this.rowCount=parseInt(O[3],10);else if(O[2])this.rowCount=parseInt(O[2],10)}}_parseRowAsArray(G){var O=new Array(G.length);for(var X=0,J=G.length;X<J;X++){var Z=G[X];if(Z!==null)O[X]=this._parsers[X](Z);else O[X]=null}return O}parseRow(G){var O={...this._prebuiltEmptyResultObject};for(var X=0,J=G.length;X<J;X++){var Z=G[X],$=this.fields[X].name;if(Z!==null)O[$]=this._parsers[X](Z);else O[$]=null}return O}addRow(G){this.rows.push(G)}addFields(G){if(this.fields=G,this.fields.length)this._parsers=new Array(G.length);var O={};for(var X=0;X<G.length;X++){var J=G[X];if(O[J.name]=null,this._types)this._parsers[X]=this._types.getTypeParser(J.dataTypeID,J.format||"text");else this._parsers[X]=c7.getTypeParser(J.dataTypeID,J.format||"text")}this._prebuiltEmptyResultObject={...O}}}f1.exports=u1});var i1=R((I4,n1)=>{var{EventEmitter:l7}=W("events"),c1=g1(),l1=l();class o1 extends l7{constructor(G,O,X){super();if(G=l1.normalizeQueryConfig(G,O,X),this.text=G.text,this.values=G.values,this.rows=G.rows,this.types=G.types,this.name=G.name,this.queryMode=G.queryMode,this.binary=G.binary,this.portal=G.portal||"",this.callback=G.callback,this._rowMode=G.rowMode,process.domain&&G.callback)this.callback=process.domain.bind(G.callback);this._result=new c1(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){if(this.queryMode==="extended")return!0;if(this.name)return!0;if(this.rows)return!0;if(!this.text)return!1;if(!this.values)return!1;return this.values.length>0}_checkForMultirow(){if(this._result.command){if(!Array.isArray(this._results))this._results=[this._result];this._result=new c1(this._rowMode,this.types),this._results.push(this._result)}}handleRowDescription(G){this._checkForMultirow(),this._result.addFields(G.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(G){let O;if(this._canceledDueToError)return;try{O=this._result.parseRow(G.fields)}catch(X){this._canceledDueToError=X;return}if(this.emit("row",O,this._result),this._accumulateRows)this._result.addRow(O)}handleCommandComplete(G,O){if(this._checkForMultirow(),this._result.addCommandComplete(G),this.rows)O.sync()}handleEmptyQuery(G){if(this.rows)G.sync()}handleError(G,O){if(this._canceledDueToError)G=this._canceledDueToError,this._canceledDueToError=!1;if(this.callback)return this.callback(G);this.emit("error",G)}handleReadyForQuery(G){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,G);if(this.callback)try{this.callback(null,this._results)}catch(O){process.nextTick(()=>{throw O})}this.emit("end",this._results)}submit(G){if(typeof this.text!=="string"&&typeof this.name!=="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");const O=G.parsedStatements[this.name];if(this.text&&O&&this.text!==O)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation())this.prepare(G);else G.query(this.text);return null}hasBeenParsed(G){return this.name&&G.parsedStatements[this.name]}handlePortalSuspended(G){this._getRows(G,this.rows)}_getRows(G,O){if(G.execute({portal:this.portal,rows:O}),!O)G.sync();else G.flush()}prepare(G){if(!this.hasBeenParsed(G))G.parse({text:this.text,name:this.name,types:this.types});try{G.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:l1.prepareValue})}catch(O){this.handleError(O,G);return}G.describe({type:"P",name:this.portal||""}),this._getRows(G,this.rows)}handleCopyInResponse(G){G.sendCopyFail("No source stream defined")}handleCopyData(G,O){}}n1.exports=o1});var C0=R((K8)=>{Object.defineProperty(K8,"__esModule",{value:!0});K8.NoticeMessage=K8.DataRowMessage=K8.CommandCompleteMessage=K8.ReadyForQueryMessage=K8.NotificationResponseMessage=K8.BackendKeyDataMessage=K8.AuthenticationMD5Password=K8.ParameterStatusMessage=K8.ParameterDescriptionMessage=K8.RowDescriptionMessage=K8.Field=K8.CopyResponse=K8.CopyDataMessage=K8.DatabaseError=K8.copyDone=K8.emptyQuery=K8.replicationStart=K8.portalSuspended=K8.noData=K8.closeComplete=K8.bindComplete=K8.parseComplete=void 0;K8.parseComplete={name:"parseComplete",length:5};K8.bindComplete={name:"bindComplete",length:5};K8.closeComplete={name:"closeComplete",length:5};K8.noData={name:"noData",length:5};K8.portalSuspended={name:"portalSuspended",length:5};K8.replicationStart={name:"replicationStart",length:4};K8.emptyQuery={name:"emptyQuery",length:4};K8.copyDone={name:"copyDone",length:4};class a1 extends Error{constructor(G,O,X){super(G);this.length=O,this.name=X}}K8.DatabaseError=a1;class s1{constructor(G,O){this.length=G,this.chunk=O,this.name="copyData"}}K8.CopyDataMessage=s1;class t1{constructor(G,O,X,J){this.length=G,this.name=O,this.binary=X,this.columnTypes=new Array(J)}}K8.CopyResponse=t1;class r1{constructor(G,O,X,J,Z,$,Y){this.name=G,this.tableID=O,this.columnID=X,this.dataTypeID=J,this.dataTypeSize=Z,this.dataTypeModifier=$,this.format=Y}}K8.Field=r1;class e1{constructor(G,O){this.length=G,this.fieldCount=O,this.name="rowDescription",this.fields=new Array(this.fieldCount)}}K8.RowDescriptionMessage=e1;class G8{constructor(G,O){this.length=G,this.parameterCount=O,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}}K8.ParameterDescriptionMessage=G8;class O8{constructor(G,O,X){this.length=G,this.parameterName=O,this.parameterValue=X,this.name="parameterStatus"}}K8.ParameterStatusMessage=O8;class X8{constructor(G,O){this.length=G,this.salt=O,this.name="authenticationMD5Password"}}K8.AuthenticationMD5Password=X8;class J8{constructor(G,O,X){this.length=G,this.processID=O,this.secretKey=X,this.name="backendKeyData"}}K8.BackendKeyDataMessage=J8;class Z8{constructor(G,O,X,J){this.length=G,this.processId=O,this.channel=X,this.payload=J,this.name="notification"}}K8.NotificationResponseMessage=Z8;class $8{constructor(G,O){this.length=G,this.status=O,this.name="readyForQuery"}}K8.ReadyForQueryMessage=$8;class Y8{constructor(G,O){this.length=G,this.text=O,this.name="commandComplete"}}K8.CommandCompleteMessage=Y8;class U8{constructor(G,O){this.length=G,this.fields=O,this.name="dataRow",this.fieldCount=O.length}}K8.DataRowMessage=U8;class H8{constructor(G,O){this.length=G,this.message=O,this.name="notice"}}K8.NoticeMessage=H8});var W8=R((E8)=>{Object.defineProperty(E8,"__esModule",{value:!0});E8.Writer=void 0;class R8{constructor(G=256){this.size=G,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(G)}ensure(G){var O=this.buffer.length-this.offset;if(O<G){var X=this.buffer,J=X.length+(X.length>>1)+G;this.buffer=Buffer.allocUnsafe(J),X.copy(this.buffer)}}addInt32(G){return this.ensure(4),this.buffer[this.offset++]=G>>>24&255,this.buffer[this.offset++]=G>>>16&255,this.buffer[this.offset++]=G>>>8&255,this.buffer[this.offset++]=G>>>0&255,this}addInt16(G){return this.ensure(2),this.buffer[this.offset++]=G>>>8&255,this.buffer[this.offset++]=G>>>0&255,this}addCString(G){if(!G)this.ensure(1);else{var O=Buffer.byteLength(G);this.ensure(O+1),this.buffer.write(G,this.offset,"utf-8"),this.offset+=O}return this.buffer[this.offset++]=0,this}addString(G=""){var O=Buffer.byteLength(G);return this.ensure(O),this.buffer.write(G,this.offset),this.offset+=O,this}add(G){return this.ensure(G.length),G.copy(this.buffer,this.offset),this.offset+=G.length,this}join(G){if(G){this.buffer[this.headerPosition]=G;const O=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(O,this.headerPosition+1)}return this.buffer.slice(G?0:5,this.offset)}flush(G){var O=this.join(G);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),O}}E8.Writer=R8});var N8=R((F8)=>{Object.defineProperty(F8,"__esModule",{value:!0});F8.serialize=void 0;var q0=W8(),F=new q0.Writer,j9=(G)=>{F.addInt16(3).addInt16(0);for(let J of Object.keys(G))F.addCString(J).addCString(G[J]);F.addCString("client_encoding").addCString("UTF8");var O=F.addCString("").flush(),X=O.length+4;return new q0.Writer().addInt32(X).add(O).flush()},W9=()=>{const G=Buffer.allocUnsafe(8);return G.writeInt32BE(8,0),G.writeInt32BE(80877103,4),G},T9=(G)=>{return F.addCString(G).flush(112)},F9=function(G,O){return F.addCString(G).addInt32(Buffer.byteLength(O)).addString(O),F.flush(112)},A9=function(G){return F.addString(G).flush(112)},N9=(G)=>{return F.addCString(G).flush(81)},T8=[],z9=(G)=>{const O=G.name||"";if(O.length>63)console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",O,O.length),console.error("This can cause conflicts and silent errors executing queries");const X=G.types||T8;var J=X.length,Z=F.addCString(O).addCString(G.text).addInt16(J);for(var $=0;$<J;$++)Z.addInt32(X[$]);return F.flush(80)},b=new q0.Writer,M9=function(G,O){for(let X=0;X<G.length;X++){const J=O?O(G[X],X):G[X];if(J==null)F.addInt16(0),b.addInt32(-1);else if(J instanceof Buffer)F.addInt16(1),b.addInt32(J.length),b.add(J);else F.addInt16(0),b.addInt32(Buffer.byteLength(J)),b.addString(J)}},L9=(G={})=>{const O=G.portal||"",X=G.statement||"",J=G.binary||!1,Z=G.values||T8,$=Z.length;return F.addCString(O).addCString(X),F.addInt16($),M9(Z,G.valueMapper),F.addInt16($),F.add(b.flush()),F.addInt16(J?1:0),F.flush(66)},V9=Buffer.from([69,0,0,0,9,0,0,0,0,0]),_9=(G)=>{if(!G||!G.portal&&!G.rows)return V9;const O=G.portal||"",X=G.rows||0,J=Buffer.byteLength(O),Z=4+J+1+4,$=Buffer.allocUnsafe(1+Z);return $[0]=69,$.writeInt32BE(Z,1),$.write(O,5,"utf-8"),$[J+5]=0,$.writeUInt32BE(X,$.length-4),$},S9=(G,O)=>{const X=Buffer.allocUnsafe(16);return X.writeInt32BE(16,0),X.writeInt16BE(1234,4),X.writeInt16BE(5678,6),X.writeInt32BE(G,8),X.writeInt32BE(O,12),X},D0=(G,O)=>{const J=4+Buffer.byteLength(O)+1,Z=Buffer.allocUnsafe(1+J);return Z[0]=G,Z.writeInt32BE(J,1),Z.write(O,5,"utf-8"),Z[J]=0,Z},I9=F.addCString("P").flush(68),P9=F.addCString("S").flush(68),C9=(G)=>{return G.name?D0(68,`${G.type}${G.name||""}`):G.type==="P"?I9:P9},q9=(G)=>{const O=`${G.type}${G.name||""}`;return D0(67,O)},D9=(G)=>{return F.add(G).flush(100)},B9=(G)=>{return D0(102,G)},G0=(G)=>Buffer.from([G,0,0,0,4]),x9=G0(72),k9=G0(83),w9=G0(88),h9=G0(99),b9={startup:j9,password:T9,requestSsl:W9,sendSASLInitialResponseMessage:F9,sendSCRAMClientFinalMessage:A9,query:N9,parse:z9,bind:L9,execute:_9,describe:C9,close:q9,flush:()=>x9,sync:()=>k9,end:()=>w9,copyData:D9,copyDone:()=>h9,copyFail:B9,cancel:S9};F8.serialize=b9});var V8=R((M8)=>{Object.defineProperty(M8,"__esModule",{value:!0});M8.BufferReader=void 0;var y9=Buffer.allocUnsafe(0);class z8{constructor(G=0){this.offset=G,this.buffer=y9,this.encoding="utf-8"}setBuffer(G,O){this.offset=G,this.buffer=O}int16(){const G=this.buffer.readInt16BE(this.offset);return this.offset+=2,G}byte(){const G=this.buffer[this.offset];return this.offset++,G}int32(){const G=this.buffer.readInt32BE(this.offset);return this.offset+=4,G}string(G){const O=this.buffer.toString(this.encoding,this.offset,this.offset+G);return this.offset+=G,O}cstring(){const G=this.offset;let O=G;while(this.buffer[O++]!==0);return this.offset=O,this.buffer.toString(this.encoding,G,O-1)}bytes(G){const O=this.buffer.slice(this.offset,this.offset+G);return this.offset+=G,O}}M8.BufferReader=z8});var q8=R((P8)=>{Object.defineProperty(P8,"__esModule",{value:!0});P8.Parser=void 0;var A=C0(),v9=V8(),B0=1,d9=4,_8=B0+d9,S8=Buffer.allocUnsafe(0);class I8{constructor(G){if(this.buffer=S8,this.bufferLength=0,this.bufferOffset=0,this.reader=new v9.BufferReader,(G===null||G===void 0?void 0:G.mode)==="binary")throw new Error("Binary mode not supported yet");this.mode=(G===null||G===void 0?void 0:G.mode)||"text"}parse(G,O){this.mergeBuffer(G);const X=this.bufferOffset+this.bufferLength;let J=this.bufferOffset;while(J+_8<=X){const Z=this.buffer[J],$=this.buffer.readUInt32BE(J+B0),Y=B0+$;if(Y+J<=X){const U=this.handlePacket(J+_8,Z,$,this.buffer);O(U),J+=Y}else break}if(J===X)this.buffer=S8,this.bufferLength=0,this.bufferOffset=0;else this.bufferLength=X-J,this.bufferOffset=J}mergeBuffer(G){if(this.bufferLength>0){const O=this.bufferLength+G.byteLength;if(O+this.bufferOffset>this.buffer.byteLength){let J;if(O<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)J=this.buffer;else{let Z=this.buffer.byteLength*2;while(O>=Z)Z*=2;J=Buffer.allocUnsafe(Z)}this.buffer.copy(J,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=J,this.bufferOffset=0}G.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=O}else this.buffer=G,this.bufferOffset=0,this.bufferLength=G.byteLength}handlePacket(G,O,X,J){switch(O){case 50:return A.bindComplete;case 49:return A.parseComplete;case 51:return A.closeComplete;case 110:return A.noData;case 115:return A.portalSuspended;case 99:return A.copyDone;case 87:return A.replicationStart;case 73:return A.emptyQuery;case 68:return this.parseDataRowMessage(G,X,J);case 67:return this.parseCommandCompleteMessage(G,X,J);case 90:return this.parseReadyForQueryMessage(G,X,J);case 65:return this.parseNotificationMessage(G,X,J);case 82:return this.parseAuthenticationResponse(G,X,J);case 83:return this.parseParameterStatusMessage(G,X,J);case 75:return this.parseBackendKeyData(G,X,J);case 69:return this.parseErrorMessage(G,X,J,"error");case 78:return this.parseErrorMessage(G,X,J,"notice");case 84:return this.parseRowDescriptionMessage(G,X,J);case 116:return this.parseParameterDescriptionMessage(G,X,J);case 71:return this.parseCopyInMessage(G,X,J);case 72:return this.parseCopyOutMessage(G,X,J);case 100:return this.parseCopyData(G,X,J);default:return new A.DatabaseError("received invalid response: "+O.toString(16),X,"error")}}parseReadyForQueryMessage(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.string(1);return new A.ReadyForQueryMessage(O,J)}parseCommandCompleteMessage(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.cstring();return new A.CommandCompleteMessage(O,J)}parseCopyData(G,O,X){const J=X.slice(G,G+(O-4));return new A.CopyDataMessage(O,J)}parseCopyInMessage(G,O,X){return this.parseCopyMessage(G,O,X,"copyInResponse")}parseCopyOutMessage(G,O,X){return this.parseCopyMessage(G,O,X,"copyOutResponse")}parseCopyMessage(G,O,X,J){this.reader.setBuffer(G,X);const Z=this.reader.byte()!==0,$=this.reader.int16(),Y=new A.CopyResponse(O,J,Z,$);for(let U=0;U<$;U++)Y.columnTypes[U]=this.reader.int16();return Y}parseNotificationMessage(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.int32(),Z=this.reader.cstring(),$=this.reader.cstring();return new A.NotificationResponseMessage(O,J,Z,$)}parseRowDescriptionMessage(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.int16(),Z=new A.RowDescriptionMessage(O,J);for(let $=0;$<J;$++)Z.fields[$]=this.parseField();return Z}parseField(){const G=this.reader.cstring(),O=this.reader.int32(),X=this.reader.int16(),J=this.reader.int32(),Z=this.reader.int16(),$=this.reader.int32(),Y=this.reader.int16()===0?"text":"binary";return new A.Field(G,O,X,J,Z,$,Y)}parseParameterDescriptionMessage(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.int16(),Z=new A.ParameterDescriptionMessage(O,J);for(let $=0;$<J;$++)Z.dataTypeIDs[$]=this.reader.int32();return Z}parseDataRowMessage(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.int16(),Z=new Array(J);for(let $=0;$<J;$++){const Y=this.reader.int32();Z[$]=Y===-1?null:this.reader.string(Y)}return new A.DataRowMessage(O,Z)}parseParameterStatusMessage(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.cstring(),Z=this.reader.cstring();return new A.ParameterStatusMessage(O,J,Z)}parseBackendKeyData(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.int32(),Z=this.reader.int32();return new A.BackendKeyDataMessage(O,J,Z)}parseAuthenticationResponse(G,O,X){this.reader.setBuffer(G,X);const J=this.reader.int32(),Z={name:"authenticationOk",length:O};switch(J){case 0:break;case 3:if(Z.length===8)Z.name="authenticationCleartextPassword";break;case 5:if(Z.length===12){Z.name="authenticationMD5Password";const Y=this.reader.bytes(4);return new A.AuthenticationMD5Password(O,Y)}break;case 10:Z.name="authenticationSASL",Z.mechanisms=[];let $;do if($=this.reader.cstring(),$)Z.mechanisms.push($);while($);break;case 11:Z.name="authenticationSASLContinue",Z.data=this.reader.string(O-8);break;case 12:Z.name="authenticationSASLFinal",Z.data=this.reader.string(O-8);break;default:throw new Error("Unknown authenticationOk message type "+J)}return Z}parseErrorMessage(G,O,X,J){this.reader.setBuffer(G,X);const Z={};let $=this.reader.string(1);while($!=="\0")Z[$]=this.reader.cstring(),$=this.reader.string(1);const Y=Z.M,U=J==="notice"?new A.NoticeMessage(O,Y):new A.DatabaseError(Y,O,J);return U.severity=Z.S,U.code=Z.C,U.detail=Z.D,U.hint=Z.H,U.position=Z.P,U.internalPosition=Z.p,U.internalQuery=Z.q,U.where=Z.W,U.schema=Z.s,U.table=Z.t,U.column=Z.c,U.dataType=Z.d,U.constraint=Z.n,U.file=Z.F,U.line=Z.L,U.routine=Z.R,U}}P8.Parser=I8});var x0=R((O0)=>{function f9(G,O){const X=new u9.Parser;return G.on("data",(J)=>X.parse(J,O)),new Promise((J)=>G.on("end",()=>J()))}Object.defineProperty(O0,"__esModule",{value:!0});O0.DatabaseError=O0.serialize=O0.parse=void 0;var m9=C0();Object.defineProperty(O0,"DatabaseError",{enumerable:!0,get:function(){return m9.DatabaseError}});var p9=N8();Object.defineProperty(O0,"serialize",{enumerable:!0,get:function(){return p9.serialize}});var u9=q8();O0.parse=f9});var D8={};E3(D8,{default:()=>l9});var l9;var B8=j3(()=>{l9={}});var x8=R((o9,k0)=>{o9.getStream=function G(O){const X=W("net");if(typeof X.Socket==="function")return new X.Socket;else{const{CloudflareSocket:J}=(B8(),R3(D8));return new J(O)}};o9.getSecureStream=function G(O){var X=W("tls");if(X.connect)return X.connect(O);else return O.socket.startTls(O),O.socket}});var w0=R((h4,w8)=>{var w4=W("net"),a9=W("events").EventEmitter,{parse:s9,serialize:N}=x0(),{getStream:t9,getSecureStream:r9}=x8(),e9=N.flush(),GG=N.sync(),OG=N.end();class k8 extends a9{constructor(G){super();if(G=G||{},this.stream=G.stream||t9(G.ssl),typeof this.stream==="function")this.stream=this.stream(G);this._keepAlive=G.keepAlive,this._keepAliveInitialDelayMillis=G.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=G.ssl||!1,this._ending=!1,this._emitMessage=!1;var O=this;this.on("newListener",function(X){if(X==="message")O._emitMessage=!0})}connect(G,O){var X=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(G,O),this.stream.once("connect",function(){if(X._keepAlive)X.stream.setKeepAlive(!0,X._keepAliveInitialDelayMillis);X.emit("connect")});const J=function(Z){if(X._ending&&(Z.code==="ECONNRESET"||Z.code==="EPIPE"))return;X.emit("error",Z)};if(this.stream.on("error",J),this.stream.on("close",function(){X.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(Z){var $=Z.toString("utf8");switch($){case"S":break;case"N":return X.stream.end(),X.emit("error",new Error("The server does not support SSL connections"));default:return X.stream.end(),X.emit("error",new Error("There was an error establishing an SSL connection"))}const Y={socket:X.stream};if(X.ssl!==!0){if(Object.assign(Y,X.ssl),"key"in X.ssl)Y.key=X.ssl.key}var U=W("net");if(U.isIP&&U.isIP(O)===0)Y.servername=O;try{X.stream=r9(Y)}catch(H){return X.emit("error",H)}X.attachListeners(X.stream),X.stream.on("error",J),X.emit("sslconnect")})}attachListeners(G){s9(G,(O)=>{var X=O.name==="error"?"errorMessage":O.name;if(this._emitMessage)this.emit("message",O);this.emit(X,O)})}requestSsl(){this.stream.write(N.requestSsl())}startup(G){this.stream.write(N.startup(G))}cancel(G,O){this._send(N.cancel(G,O))}password(G){this._send(N.password(G))}sendSASLInitialResponseMessage(G,O){this._send(N.sendSASLInitialResponseMessage(G,O))}sendSCRAMClientFinalMessage(G){this._send(N.sendSCRAMClientFinalMessage(G))}_send(G){if(!this.stream.writable)return!1;return this.stream.write(G)}query(G){this._send(N.query(G))}parse(G){this._send(N.parse(G))}bind(G){this._send(N.bind(G))}execute(G){this._send(N.execute(G))}flush(){if(this.stream.writable)this.stream.write(e9)}sync(){this._ending=!0,this._send(GG)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(OG,()=>{this.stream.end()})}close(G){this._send(N.close(G))}describe(G){this._send(N.describe(G))}sendCopyFromChunk(G){this._send(N.copyData(G))}endCopyFrom(){this._send(N.copyDone())}sendCopyFail(G){this._send(N.copyFail(G))}}w8.exports=k8});var v8=R((b4,y8)=>{function ZG(G,O,X){let J;if(this.overflow){if(J=this[X0].write(G).split(this.matcher),J.length===1)return X();J.shift(),this.overflow=!1}else this[C]+=this[X0].write(G),J=this[C].split(this.matcher);this[C]=J.pop();for(let Z=0;Z<J.length;Z++)try{b8(this,this.mapper(J[Z]))}catch($){return X($)}if(this.overflow=this[C].length>this.maxLength,this.overflow&&!this.skipOverflow){X(new Error("maximum buffer reached"));return}X()}function $G(G){if(this[C]+=this[X0].end(),this[C])try{b8(this,this.mapper(this[C]))}catch(O){return G(O)}G()}function b8(G,O){if(O!==void 0)G.push(O)}function h8(G){return G}function YG(G,O,X){switch(G=G||/\r?\n/,O=O||h8,X=X||{},arguments.length){case 1:if(typeof G==="function")O=G,G=/\r?\n/;else if(typeof G==="object"&&!(G instanceof RegExp)&&!G[Symbol.split])X=G,G=/\r?\n/;break;case 2:if(typeof G==="function")X=O,O=G,G=/\r?\n/;else if(typeof O==="object")X=O,O=h8}X=Object.assign({},X),X.autoDestroy=!0,X.transform=ZG,X.flush=$G,X.readableObjectMode=!0;const J=new XG(X);return J[C]="",J[X0]=new JG("utf8"),J.matcher=G,J.mapper=O,J.maxLength=X.maxLength,J.skipOverflow=X.skipOverflow||!1,J.overflow=!1,J._destroy=function(Z,$){this._writableState.errorEmitted=!1,$(Z)},J}var{Transform:XG}=W("stream"),{StringDecoder:JG}=W("string_decoder"),C=Symbol("last"),X0=Symbol("decoder");y8.exports=YG});var p8=R((zG,P)=>{function WG(G){return(G&EG)==jG}function b0(){var G=n instanceof UG&&n.writable===!0;if(G){var O=Array.prototype.slice.call(arguments).concat("\n");n.write(m8.format.apply(m8,O))}}var d8=W("path"),UG=W("stream").Stream,HG=v8(),m8=W("util"),KG=5432,J0=process.platform==="win32",n=process.stderr,QG=56,RG=7,EG=61440,jG=32768,y=["host","port","database","user","password"],h0=y.length,TG=y[h0-1];Object.defineProperty(zG,"isWin",{get:function(){return J0},set:function(G){J0=G}});zG.warnTo=function(G){var O=n;return n=G,O};zG.getFileName=function(G){var O=G||process.env,X=O.PGPASSFILE||(J0?d8.join(O.APPDATA||"./","postgresql","pgpass.conf"):d8.join(O.HOME||"./",".pgpass"));return X};zG.usePgPass=function(G,O){if(Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD"))return!1;if(J0)return!0;if(O=O||"<unkn>",!WG(G.mode))return b0('WARNING: password file "%s" is not a plain file',O),!1;if(G.mode&(QG|RG))return b0('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',O),!1;return!0};var FG=zG.match=function(G,O){return y.slice(0,-1).reduce(function(X,J,Z){if(Z==1){if(Number(G[J]||KG)===Number(O[J]))return X&&!0}return X&&(O[J]==="*"||O[J]===G[J])},!0)};zG.getPassword=function(G,O,X){var J,Z=O.pipe(HG());function $(H){var K=AG(H);if(K&&NG(K)&&FG(G,K))J=K[TG],Z.end()}var Y=function(){O.destroy(),X(J)},U=function(H){O.destroy(),b0("WARNING: error on reading file: %s",H),X(void 0)};O.on("error",U),Z.on("data",$).on("end",Y).on("error",U)};var AG=zG.parseLine=function(G){if(G.length<11||G.match(/^\s+#/))return null;var O="",X="",J=0,Z=0,$=0,Y={},U=!1,H=function(Q,E,j){var z=G.substring(E,j);if(!Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE"))z=z.replace(/\\([:\\])/g,"$1");Y[y[Q]]=z};for(var K=0;K<G.length-1;K+=1){if(O=G.charAt(K+1),X=G.charAt(K),U=J==h0-1,U){H(J,Z);break}if(K>=0&&O==":"&&X!=="\\")H(J,Z,K+1),Z=K+2,J+=1}return Y=Object.keys(Y).length===h0?Y:null,Y},NG=zG.isValidEntry=function(G){var O={0:function(Y){return Y.length>0},1:function(Y){if(Y==="*")return!0;return Y=Number(Y),isFinite(Y)&&Y>0&&Y<9007199254740992&&Math.floor(Y)===Y},2:function(Y){return Y.length>0},3:function(Y){return Y.length>0},4:function(Y){return Y.length>0}};for(var X=0;X<y.length;X+=1){var J=O[X],Z=G[y[X]]||"",$=J(Z);if(!$)return!1}return!0}});var f8=R((p4,y0)=>{var m4=W("path"),u8=W("fs"),Z0=p8();y0.exports=function(G,O){var X=Z0.getFileName();u8.stat(X,function(J,Z){if(J||!Z0.usePgPass(Z,X))return O(void 0);var $=u8.createReadStream(X);Z0.getPassword(G,$,O)})};y0.exports.warnTo=Z0.warnTo});var o8=R((u4,l8)=>{var SG=W("events").EventEmitter,g8=l(),v0=k1(),IG=S0(),PG=P0(),c8=i1(),CG=c(),qG=w0(),DG=_0();class d0 extends SG{constructor(G){super();this.connectionParameters=new PG(G),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var O=G||{};if(this._Promise=O.Promise||global.Promise,this._types=new IG(O.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=O.connection||new qG({stream:O.stream,ssl:this.connectionParameters.ssl,keepAlive:O.keepAlive||!1,keepAliveInitialDelayMillis:O.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=O.binary||CG.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key)Object.defineProperty(this.ssl,"key",{enumerable:!1});this._connectionTimeoutMillis=O.connectionTimeoutMillis||0}_errorAllQueries(G){const O=(X)=>{process.nextTick(()=>{X.handleError(G,this.connection)})};if(this.activeQuery)O(this.activeQuery),this.activeQuery=null;this.queryQueue.forEach(O),this.queryQueue.length=0}_connect(G){var O=this,X=this.connection;if(this._connectionCallback=G,this._connecting||this._connected){const J=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{G(J)});return}if(this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0)this.connectionTimeoutHandle=setTimeout(()=>{X._ending=!0,X.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis);if(this.host&&this.host.indexOf("/")===0)X.connect(this.host+"/.s.PGSQL."+this.port);else X.connect(this.port,this.host);X.on("connect",function(){if(O.ssl)X.requestSsl();else X.startup(O.getStartupConf())}),X.on("sslconnect",function(){X.startup(O.getStartupConf())}),this._attachListeners(X),X.once("end",()=>{const J=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");if(clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(J),this._ended=!0,!this._ending){if(this._connecting&&!this._connectionError)if(this._connectionCallback)this._connectionCallback(J);else this._handleErrorEvent(J);else if(!this._connectionError)this._handleErrorEvent(J)}process.nextTick(()=>{this.emit("end")})})}connect(G){if(G){this._connect(G);return}return new this._Promise((O,X)=>{this._connect((J)=>{if(J)X(J);else O()})})}_attachListeners(G){G.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),G.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),G.on("authenticationSASL",this._handleAuthSASL.bind(this)),G.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),G.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),G.on("backendKeyData",this._handleBackendKeyData.bind(this)),G.on("error",this._handleErrorEvent.bind(this)),G.on("errorMessage",this._handleErrorMessage.bind(this)),G.on("readyForQuery",this._handleReadyForQuery.bind(this)),G.on("notice",this._handleNotice.bind(this)),G.on("rowDescription",this._handleRowDescription.bind(this)),G.on("dataRow",this._handleDataRow.bind(this)),G.on("portalSuspended",this._handlePortalSuspended.bind(this)),G.on("emptyQuery",this._handleEmptyQuery.bind(this)),G.on("commandComplete",this._handleCommandComplete.bind(this)),G.on("parseComplete",this._handleParseComplete.bind(this)),G.on("copyInResponse",this._handleCopyInResponse.bind(this)),G.on("copyData",this._handleCopyData.bind(this)),G.on("notification",this._handleNotification.bind(this))}_checkPgPass(G){const O=this.connection;if(typeof this.password==="function")this._Promise.resolve().then(()=>this.password()).then((X)=>{if(X!==void 0){if(typeof X!=="string"){O.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=X}else this.connectionParameters.password=this.password=null;G()}).catch((X)=>{O.emit("error",X)});else if(this.password!==null)G();else try{f8()(this.connectionParameters,(J)=>{if(J!==void 0)this.connectionParameters.password=this.password=J;G()})}catch(X){this.emit("error",X)}}_handleAuthCleartextPassword(G){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(G){this._checkPgPass(async()=>{try{const O=await DG.postgresMd5PasswordHash(this.user,this.password,G.salt);this.connection.password(O)}catch(O){this.emit("error",O)}})}_handleAuthSASL(G){this._checkPgPass(()=>{try{this.saslSession=v0.startSession(G.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(O){this.connection.emit("error",O)}})}async _handleAuthSASLContinue(G){try{await v0.continueSession(this.saslSession,this.password,G.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(O){this.connection.emit("error",O)}}_handleAuthSASLFinal(G){try{v0.finalizeSession(this.saslSession,G.data),this.saslSession=null}catch(O){this.connection.emit("error",O)}}_handleBackendKeyData(G){this.processID=G.processID,this.secretKey=G.secretKey}_handleReadyForQuery(G){if(this._connecting){if(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)this._connectionCallback(null,this),this._connectionCallback=null;this.emit("connect")}const{activeQuery:O}=this;if(this.activeQuery=null,this.readyForQuery=!0,O)O.handleReadyForQuery(this.connection);this._pulseQueryQueue()}_handleErrorWhileConnecting(G){if(this._connectionError)return;if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(G);this.emit("error",G)}_handleErrorEvent(G){if(this._connecting)return this._handleErrorWhileConnecting(G);this._queryable=!1,this._errorAllQueries(G),this.emit("error",G)}_handleErrorMessage(G){if(this._connecting)return this._handleErrorWhileConnecting(G);const O=this.activeQuery;if(!O){this._handleErrorEvent(G);return}this.activeQuery=null,O.handleError(G,this.connection)}_handleRowDescription(G){this.activeQuery.handleRowDescription(G)}_handleDataRow(G){this.activeQuery.handleDataRow(G)}_handlePortalSuspended(G){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(G){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(G){this.activeQuery.handleCommandComplete(G,this.connection)}_handleParseComplete(G){if(this.activeQuery.name)this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text}_handleCopyInResponse(G){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(G){this.activeQuery.handleCopyData(G,this.connection)}_handleNotification(G){this.emit("notification",G)}_handleNotice(G){this.emit("notice",G)}getStartupConf(){var G=this.connectionParameters,O={user:G.user,database:G.database},X=G.application_name||G.fallback_application_name;if(X)O.application_name=X;if(G.replication)O.replication=""+G.replication;if(G.statement_timeout)O.statement_timeout=String(parseInt(G.statement_timeout,10));if(G.lock_timeout)O.lock_timeout=String(parseInt(G.lock_timeout,10));if(G.idle_in_transaction_session_timeout)O.idle_in_transaction_session_timeout=String(parseInt(G.idle_in_transaction_session_timeout,10));if(G.options)O.options=G.options;return O}cancel(G,O){if(G.activeQuery===O){var X=this.connection;if(this.host&&this.host.indexOf("/")===0)X.connect(this.host+"/.s.PGSQL."+this.port);else X.connect(this.port,this.host);X.on("connect",function(){X.cancel(G.processID,G.secretKey)})}else if(G.queryQueue.indexOf(O)!==-1)G.queryQueue.splice(G.queryQueue.indexOf(O),1)}setTypeParser(G,O,X){return this._types.setTypeParser(G,O,X)}getTypeParser(G,O){return this._types.getTypeParser(G,O)}escapeIdentifier(G){return g8.escapeIdentifier(G)}escapeLiteral(G){return g8.escapeLiteral(G)}_pulseQueryQueue(){if(this.readyForQuery===!0){if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;const G=this.activeQuery.submit(this.connection);if(G)process.nextTick(()=>{this.activeQuery.handleError(G,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else if(this.hasExecuted)this.activeQuery=null,this.emit("drain")}}query(G,O,X){var J,Z,$,Y,U;if(G===null||G===void 0)throw new TypeError("Client was passed a null or undefined query");else if(typeof G.submit==="function"){if($=G.query_timeout||this.connectionParameters.query_timeout,Z=J=G,typeof O==="function")J.callback=J.callback||O}else if($=this.connectionParameters.query_timeout,J=new c8(G,O,X),!J.callback)Z=new this._Promise((H,K)=>{J.callback=(Q,E)=>Q?K(Q):H(E)}).catch((H)=>{throw Error.captureStackTrace(H),H});if($)U=J.callback,Y=setTimeout(()=>{var H=new Error("Query read timeout");process.nextTick(()=>{J.handleError(H,this.connection)}),U(H),J.callback=()=>{};var K=this.queryQueue.indexOf(J);if(K>-1)this.queryQueue.splice(K,1);this._pulseQueryQueue()},$),J.callback=(H,K)=>{clearTimeout(Y),U(H,K)};if(this.binary&&!J.binary)J.binary=!0;if(J._result&&!J._result._types)J._result._types=this._types;if(!this._queryable)return process.nextTick(()=>{J.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),Z;if(this._ending)return process.nextTick(()=>{J.handleError(new Error("Client was closed and is not queryable"),this.connection)}),Z;return this.queryQueue.push(J),this._pulseQueryQueue(),Z}ref(){this.connection.ref()}unref(){this.connection.unref()}end(G){if(this._ending=!0,!this.connection._connecting||this._ended)if(G)G();else return this._Promise.resolve();if(this.activeQuery||!this._queryable)this.connection.stream.destroy();else this.connection.end();if(G)this.connection.once("end",G);else return new this._Promise((O)=>{this.connection.once("end",O)})}}d0.Query=c8;l8.exports=d0});var r8=R((f4,t8)=>{function xG(){throw new Error("Release called on client which has already been released to the pool.")}function $0(G,O){if(O)return{callback:O,result:void 0};let X,J;const Z=function(Y,U){Y?X(Y):J(U)},$=new G(function(Y,U){J=Y,X=U}).catch((Y)=>{throw Error.captureStackTrace(Y),Y});return{callback:Z,result:$}}function kG(G,O){return function X(J){J.client=O,O.removeListener("error",X),O.on("error",()=>{G.log("additional client error after disconnection due to error",J)}),G._remove(O),G.emit("error",J,O)}}var BG=W("events").EventEmitter,n8=function(){},i8=(G,O)=>{const X=G.findIndex(O);return X===-1?void 0:G.splice(X,1)[0]};class a8{constructor(G,O,X){this.client=G,this.idleListener=O,this.timeoutId=X}}class i{constructor(G){this.callback=G}}class s8 extends BG{constructor(G,O){super();if(this.options=Object.assign({},G),G!=null&&"password"in G)Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:G.password});if(G!=null&&G.ssl&&G.ssl.key)Object.defineProperty(this.options.ssl,"key",{enumerable:!1});if(this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||O||m0().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis==="undefined")this.options.idleTimeoutMillis=1e4;this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){if(this.log("pulse queue on ending"),this._idle.length)this._idle.slice().map((O)=>{this._remove(O.client)});if(!this._clients.length)this.ended=!0,this._endCallback();return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;const G=this._pendingQueue.shift();if(this._idle.length){const O=this._idle.pop();clearTimeout(O.timeoutId);const X=O.client;X.ref&&X.ref();const J=O.idleListener;return this._acquireClient(X,G,J,!1)}if(!this._isFull())return this.newClient(G);throw new Error("unexpected condition")}_remove(G){const O=i8(this._idle,(X)=>X.client===G);if(O!==void 0)clearTimeout(O.timeoutId);this._clients=this._clients.filter((X)=>X!==G),G.end(),this.emit("remove",G)}connect(G){if(this.ending){const J=new Error("Cannot use a pool after calling end on the pool");return G?G(J):this.Promise.reject(J)}const O=$0(this.Promise,G),X=O.result;if(this._isFull()||this._idle.length){if(this._idle.length)process.nextTick(()=>this._pulseQueue());if(!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new i(O.callback)),X;const J=(Y,U,H)=>{clearTimeout($),O.callback(Y,U,H)},Z=new i(J),$=setTimeout(()=>{i8(this._pendingQueue,(Y)=>Y.callback===J),Z.timedOut=!0,O.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(Z),X}return this.newClient(new i(O.callback)),X}newClient(G){const O=new this.Client(this.options);this._clients.push(O);const X=kG(this,O);this.log("checking client timeout");let J,Z=!1;if(this.options.connectionTimeoutMillis)J=setTimeout(()=>{this.log("ending client due to timeout"),Z=!0,O.connection?O.connection.stream.destroy():O.end()},this.options.connectionTimeoutMillis);this.log("connecting new client"),O.connect(($)=>{if(J)clearTimeout(J);if(O.on("error",X),$){if(this.log("client failed to connect",$),this._clients=this._clients.filter((Y)=>Y!==O),Z)$.message="Connection terminated due to connection timeout";if(this._pulseQueue(),!G.timedOut)G.callback($,void 0,n8)}else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){const Y=setTimeout(()=>{if(this.log("ending client due to expired lifetime"),this._expired.add(O),this._idle.findIndex((H)=>H.client===O)!==-1)this._acquireClient(O,new i((H,K,Q)=>Q()),X,!1)},this.options.maxLifetimeSeconds*1000);Y.unref(),O.once("end",()=>clearTimeout(Y))}return this._acquireClient(O,G,X,!0)}})}_acquireClient(G,O,X,J){if(J)this.emit("connect",G);if(this.emit("acquire",G),G.release=this._releaseOnce(G,X),G.removeListener("error",X),!O.timedOut)if(J&&this.options.verify)this.options.verify(G,(Z)=>{if(Z)return G.release(Z),O.callback(Z,void 0,n8);O.callback(void 0,G,G.release)});else O.callback(void 0,G,G.release);else if(J&&this.options.verify)this.options.verify(G,G.release);else G.release()}_releaseOnce(G,O){let X=!1;return(J)=>{if(X)xG();X=!0,this._release(G,O,J)}}_release(G,O,X){if(G.on("error",O),G._poolUseCount=(G._poolUseCount||0)+1,this.emit("release",X,G),X||this.ending||!G._queryable||G._ending||G._poolUseCount>=this.options.maxUses){if(G._poolUseCount>=this.options.maxUses)this.log("remove expended client");this._remove(G),this._pulseQueue();return}if(this._expired.has(G)){this.log("remove expired client"),this._expired.delete(G),this._remove(G),this._pulseQueue();return}let Z;if(this.options.idleTimeoutMillis){if(Z=setTimeout(()=>{this.log("remove idle client"),this._remove(G)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle)Z.unref()}if(this.options.allowExitOnIdle)G.unref();this._idle.push(new a8(G,O,Z)),this._pulseQueue()}query(G,O,X){if(typeof G==="function"){const Z=$0(this.Promise,G);return setImmediate(function(){return Z.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),Z.result}if(typeof O==="function")X=O,O=void 0;const J=$0(this.Promise,X);return X=J.callback,this.connect((Z,$)=>{if(Z)return X(Z);let Y=!1;const U=(H)=>{if(Y)return;Y=!0,$.release(H),X(H)};$.once("error",U),this.log("dispatching query");try{$.query(G,O,(H,K)=>{if(this.log("query dispatched"),$.removeListener("error",U),Y)return;if(Y=!0,$.release(H),H)return X(H);return X(void 0,K)})}catch(H){return $.release(H),X(H)}}),J.result}end(G){if(this.log("ending"),this.ending){const X=new Error("Called end on pool more than once");return G?G(X):this.Promise.reject(X)}this.ending=!0;const O=$0(this.Promise,G);return this._endCallback=O.callback,this._pulseQueue(),O.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((G,O)=>G+(this._expired.has(O)?1:0),0)}get totalCount(){return this._clients.length}}t8.exports=s8});var O3=R((g4,G3)=>{var e8=W("events").EventEmitter,wG=W("util"),p0=l(),v=G3.exports=function(G,O,X){e8.call(this),G=p0.normalizeQueryConfig(G,O,X),this.text=G.text,this.values=G.values,this.name=G.name,this.queryMode=G.queryMode,this.callback=G.callback,this.state="new",this._arrayMode=G.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(J){if(J==="row")this._emitRowEvents=!0}.bind(this))};wG.inherits(v,e8);var hG={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};v.prototype.handleError=function(G){var O=this.native.pq.resultErrorFields();if(O)for(var X in O){var J=hG[X]||X;G[J]=O[X]}if(this.callback)this.callback(G);else this.emit("error",G);this.state="error"};v.prototype.then=function(G,O){return this._getPromise().then(G,O)};v.prototype.catch=function(G){return this._getPromise().catch(G)};v.prototype._getPromise=function(){if(this._promise)return this._promise;return this._promise=new Promise(function(G,O){this._once("end",G),this._once("error",O)}.bind(this)),this._promise};v.prototype.submit=function(G){this.state="running";var O=this;this.native=G.native,G.native.arrayMode=this._arrayMode;var X=function($,Y,U){if(G.native.arrayMode=!1,setImmediate(function(){O.emit("_done")}),$)return O.handleError($);if(O._emitRowEvents)if(U.length>1)Y.forEach((H,K)=>{H.forEach((Q)=>{O.emit("row",Q,U[K])})});else Y.forEach(function(H){O.emit("row",H,U)});if(O.state="end",O.emit("end",U),O.callback)O.callback(null,U)};if(process.domain)X=process.domain.bind(X);if(this.name){if(this.name.length>63)console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries");var J=(this.values||[]).map(p0.prepareValue);if(G.namedQueries[this.name]){if(this.text&&G.namedQueries[this.name]!==this.text){const $=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return X($)}return G.native.execute(this.name,J,X)}return G.native.prepare(this.name,this.text,J.length,function($){if($)return X($);return G.namedQueries[O.name]=O.text,O.native.execute(O.name,J,X)})}else if(this.values){if(!Array.isArray(this.values)){const $=new Error("Query values must be an array");return X($)}var Z=this.values.map(p0.prepareValue);G.native.query(this.text,Z,X)}else if(this.queryMode==="extended")G.native.query(this.text,[],X);else G.native.query(this.text,X)}});var u0=R((c4,$3)=>{var X3;try{X3=(()=>{throw new Error(`Cannot require module "pg-native"`);})()}catch(G){throw G}var bG=S0(),J3=W("events").EventEmitter,yG=W("util"),vG=P0(),Z3=O3(),_=$3.exports=function(G){J3.call(this),G=G||{},this._Promise=G.Promise||global.Promise,this._types=new bG(G.types),this.native=new X3({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var O=this.connectionParameters=new vG(G);if(G.nativeConnectionString)O.nativeConnectionString=G.nativeConnectionString;this.user=O.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:O.password}),this.database=O.database,this.host=O.host,this.port=O.port,this.namedQueries={}};_.Query=Z3;yG.inherits(_,J3);_.prototype._errorAllQueries=function(G){const O=(X)=>{process.nextTick(()=>{X.native=this.native,X.handleError(G)})};if(this._hasActiveQuery())O(this._activeQuery),this._activeQuery=null;this._queryQueue.forEach(O),this._queryQueue.length=0};_.prototype._connect=function(G){var O=this;if(this._connecting){process.nextTick(()=>G(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(X,J){if(O.connectionParameters.nativeConnectionString)J=O.connectionParameters.nativeConnectionString;if(X)return G(X);O.native.connect(J,function(Z){if(Z)return O.native.end(),G(Z);O._connected=!0,O.native.on("error",function($){O._queryable=!1,O._errorAllQueries($),O.emit("error",$)}),O.native.on("notification",function($){O.emit("notification",{channel:$.relname,payload:$.extra})}),O.emit("connect"),O._pulseQueryQueue(!0),G()})})};_.prototype.connect=function(G){if(G){this._connect(G);return}return new this._Promise((O,X)=>{this._connect((J)=>{if(J)X(J);else O()})})};_.prototype.query=function(G,O,X){var J,Z,$,Y,U;if(G===null||G===void 0)throw new TypeError("Client was passed a null or undefined query");else if(typeof G.submit==="function"){if($=G.query_timeout||this.connectionParameters.query_timeout,Z=J=G,typeof O==="function")G.callback=O}else if($=this.connectionParameters.query_timeout,J=new Z3(G,O,X),!J.callback){let H,K;Z=new this._Promise((Q,E)=>{H=Q,K=E}).catch((Q)=>{throw Error.captureStackTrace(Q),Q}),J.callback=(Q,E)=>Q?K(Q):H(E)}if($)U=J.callback,Y=setTimeout(()=>{var H=new Error("Query read timeout");process.nextTick(()=>{J.handleError(H,this.connection)}),U(H),J.callback=()=>{};var K=this._queryQueue.indexOf(J);if(K>-1)this._queryQueue.splice(K,1);this._pulseQueryQueue()},$),J.callback=(H,K)=>{clearTimeout(Y),U(H,K)};if(!this._queryable)return J.native=this.native,process.nextTick(()=>{J.handleError(new Error("Client has encountered a connection error and is not queryable"))}),Z;if(this._ending)return J.native=this.native,process.nextTick(()=>{J.handleError(new Error("Client was closed and is not queryable"))}),Z;return this._queryQueue.push(J),this._pulseQueryQueue(),Z};_.prototype.end=function(G){var O=this;if(this._ending=!0,!this._connected)this.once("connect",this.end.bind(this,G));var X;if(!G)X=new this._Promise(function(J,Z){G=($)=>$?Z($):J()});return this.native.end(function(){O._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{if(O.emit("end"),G)G()})}),X};_.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};_.prototype._pulseQueryQueue=function(G){if(!this._connected)return;if(this._hasActiveQuery())return;var O=this._queryQueue.shift();if(!O){if(!G)this.emit("drain");return}this._activeQuery=O,O.submit(this);var X=this;O.once("_done",function(){X._pulseQueryQueue()})};_.prototype.cancel=function(G){if(this._activeQuery===G)this.native.cancel(function(){});else if(this._queryQueue.indexOf(G)!==-1)this._queryQueue.splice(this._queryQueue.indexOf(G),1)};_.prototype.ref=function(){};_.prototype.unref=function(){};_.prototype.setTypeParser=function(G,O,X){return this._types.setTypeParser(G,O,X)};_.prototype.getTypeParser=function(G,O){return this._types.getTypeParser(G,O)}});var m0=R((l4,a)=>{var dG=o8(),mG=c(),pG=w0(),uG=r8(),{DatabaseError:fG}=x0(),{escapeIdentifier:gG,escapeLiteral:cG}=l(),lG=(G)=>{return class O extends uG{constructor(X){super(X,G)}}},f0=function(G){this.defaults=mG,this.Client=G,this.Query=this.Client.Query,this.Pool=lG(this.Client),this._pools=[],this.Connection=pG,this.types=g(),this.DatabaseError=fG,this.escapeIdentifier=gG,this.escapeLiteral=cG};if(typeof process.env.NODE_PG_FORCE_NATIVE!=="undefined")a.exports=new f0(u0());else a.exports=new f0(dG),Object.defineProperty(a.exports,"native",{configurable:!0,enumerable:!1,get(){var G=null;try{G=new f0(u0())}catch(O){if(O.code!=="MODULE_NOT_FOUND")throw O}return Object.defineProperty(a.exports,"native",{value:G}),G}})});var Y3=Q3(m0(),1);import oG from"fs";var g0={user:"bun_user",host:"m4cgyver-archives-backend-postgres",database:"webpages",password:"bun_password",port:5432};async function tG(G){const O=await q(),{uri_string:X,file_string:J,content_type_string:Z,resource_type_string:$,record_length:Y,record_offset:U,content_offset:H,content_length:K,status:Q,meta:E}=G;try{await O.query(`
        SELECT insert_response(
            \$1, \$2, \$3, \$4, \$5, \$6, \$7, \$8, \$9, \$10
        );
    `,[X,J,Z,$,Y,U,H,K,Q,JSON.stringify(E)])}catch(z){throw console.error("Error inserting response:",z),z}}async function rG(G){const{search_uri_a:O,limit_num_a:X=32,offset_num_a:J=0,search_ip_a:Z=null,search_content_type_a:$=null}=G,Y=await q();try{return(await Y.query(`
        SELECT * FROM search_responses(
            \$1, \$2, \$3, \$4, \$5
        );
    `,[O,X,J,Z,$])).rows}catch(H){throw console.error("Error searching responses:",H),H}}async function eG(G){const O=await q();try{return(await O.query(`
        SELECT * FROM retrieve_response(
            \$1
        );
    `,[G])).rows}catch(J){throw console.error("Error retrieving response:",J),J}}async function G4(G){const O=await q();try{return(await O.query(`
        SELECT * FROM retrieve_response_full(
            \$1
        );
    `,[G])).rows}catch(J){throw console.error("Error retrieving full response:",J),J}}var nG=process.hrtime()[1],B=null,q=async(G)=>{const O={...g0,...G};if(B===null)try{console.log(`Creating a new database connection pool ${nG} conns ${O.max} ${O.maxUses}...`),B=new Y3.Pool({...g0,...G}),B.on("error",(X,J)=>{if(console.error(`Database connection error at ${new Date().toISOString()}:`,X.message),J)console.error(`Client details: ${J}`)})}catch(X){return console.log(`Failed to connect ${X.message} retrying...`),await new Promise((J)=>setTimeout(J,3000)),q()}return B},iG=async()=>{try{return(await(await q()).connect()).release(),{status:"connected"}}catch(G){return{status:"error",message:G instanceof Error?G.message:"Unknown error"}}},aG=async()=>{const G=await q();try{console.time("Resetting db");const O=oG.readFileSync("libs/database/setup.pg.sql","utf8");console.timeEnd("Resetting db"),console.log("Successfully reset db"),await G.query(O)}catch(O){throw console.error("Error setting up the database:",O),O}},sG=async()=>{if(B)await B.end(),B=null},O4=async(G)=>{const O=await q();try{return(await O.query("SELECT * FROM latest_responses($1)",[G])).rows}catch(J){throw console.error("Error retrieving latest responses:",J),J}};self.onmessage=async(G)=>{const{id:O,action:X,params:J}=G.data;let Z;try{switch(X){case"connectDb":Z={status:"sucess",data:await iG(J)};break;case"setupDb":Z={status:"sucess",data:await aG()};break;case"closeDb":Z={status:"sucess",data:await sG()};break;case"dbInsertResponse":Z={status:"sucess",data:await tG(J)};break;case"dbSearchResponses":Z={status:"sucess",data:await rG(J)};break;case"dbRetrieveResponse":Z={status:"sucess",data:await eG(J)};break;case"dbRetrieveResponseFull":Z={status:"sucess",data:await G4(J)};break;case"dbRetrieveLatestResponses":Z={status:"sucess",data:await O4(J)};break;default:Z={status:"error",message:`Unknown action ${X}`}}}catch($){Z={status:"error",message:"Worker error"}}postMessage({id:O,...Z})};
